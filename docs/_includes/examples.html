<main class="md-check__main"><script type="application/ld+json">[{"@context":"http://schema.org","@type":"WebPage","name":"@btilford/md-check","url":"https://btilford.github.io/md-check/","author":"btilford","copyrightHolder":{"@type":"Person","name":"Ben Tilford"},"copyrightYear":2020,"dateModified":"2020-04-13T05:32:08.244Z","discussionUrl":"https://github.com/btilford/md-check/issues","description":"Compile and execute markdown code fences","keywords":["markdown","documentation","docs"]},{"@context":"http://schema.org","@type":"Project","name":"@btilford/md-check","founder":"btilford","url":"https://github.com/btilford/md-check","description":"Compile and execute markdown code fences","sameAs":"git+ssh://git@github.com/btilford/md-check.git","contactPoint":{"url":"https://github.com/btilford/md-check/issues"}},{"@context":"http://schema.org","@type":"SoftwareSourceCode","name":"@btilford/md-check","version":"1.0.1","codeRepository":"git+ssh://git@github.com/btilford/md-check.git","codeSampleType":"full","programmingLanguage":["Typescript","Javacript","Markdown"],"runtimePlatform":"NodeJS","copyrightHolder":"Ben Tilford","copyrightYear":2020,"dateModified":"2020-04-13T05:32:08.244Z","discussionUrl":"https://github.com/btilford/md-check/issues","description":"Compile and execute markdown code fences","license":"https://github.com/btilford/md-check/LICENSE","keywords":["markdown","documentation","docs"],"contributor":[{"@type":"Person"}],"maintainer":[],"url":"https://github.com/btilford/md-check","inLanguage":"en-US"}]</script>
<nav class="md-check__nav">
 <ol class="nav__list">
<li class="nav__item"><a class="nav__link"
       href="#file_src-0-README-md" 
       title="Check your docs!">md-check</a>
   <div class="nav__sub">
     <ol class="nav__list">
<li class="nav__item"><a class="md-check__nav-link"
       href="#src-0-README-md_Installation" 
       title="undefined">Installation</a> 
</li>
      

<li class="nav__item"><a class="md-check__nav-link"
       href="#src-0-README-md_Getting-Started" 
       title="Configure and run md-check">Getting Started</a> 
</li>
      

<li class="nav__item"><a class="md-check__nav-link"
       href="#src-0-README-md_Development" 
       title="Building md-check">Development</a> 
</li>
      </ol>
   </div> 
</li>
      

<li class="nav__item"><a class="nav__link"
       href="#file_src-1-writing-markdown-md" 
       title="How to write the markdown for md-check to work.">Writing Markdown.</a>
   <div class="nav__sub">
     <ol class="nav__list">
<li class="nav__item"><a class="md-check__nav-link"
       href="#src-1-writing-markdown-md_Executing-Code-Blocks" 
       title="Trigger execution of fences">Executing Code Blocks</a> 
</li>
      </ol>
   </div> 
</li>
      

<li class="nav__item"><a class="nav__link"
       href="#file_src-mocha-mdx" 
       title="Execute code blocks containing mocha tests">Run Mocha</a>
   <div class="nav__sub">
     <ol class="nav__list">
<li class="nav__item"><a class="md-check__nav-link"
       href="#src-mocha-mdx_Example-Test" 
       title="undefined">Example Test</a> 
</li>
      

<li class="nav__item"><a class="md-check__nav-link"
       href="#src-mocha-mdx_Install" 
       title="undefined">Install</a> 
</li>
      

<li class="nav__item"><a class="md-check__nav-link"
       href="#src-mocha-mdx_Configure" 
       title="Configuring the mocha executor">Configure</a> 
</li>
      </ol>
   </div> 
</li>
      

<li class="nav__item"><a class="nav__link"
       href="#file_src-node-mdx" 
       title="Executing javascript code blocks.">Node Examples</a>
   <div class="nav__sub">
     <ol class="nav__list">
<li class="nav__item"><a class="md-check__nav-link"
       href="#src-node-mdx_Capture-stdout" 
       title="Capture stdout/stderr from a node script.">Capture stdout</a> 
</li>
      

<li class="nav__item"><a class="md-check__nav-link"
       href="#src-node-mdx_Configuration" 
       title="Setup the node executor">Configuration</a> 
</li>
      </ol>
   </div> 
</li>
      

<li class="nav__item"><a class="nav__link"
       href="#file_src-shell-mdx" 
       title="Executing shell script blocks.">Shell Examples</a>
   <div class="nav__sub">
     <ol class="nav__list">
<li class="nav__item"><a class="md-check__nav-link"
       href="#src-shell-mdx_bash" 
       title="Executing as a bash script">bash</a> 
</li>
      

<li class="nav__item"><a class="md-check__nav-link"
       href="#src-shell-mdx_eval" 
       title="Eval a markdown fence">eval</a> 
</li>
      

<li class="nav__item"><a class="md-check__nav-link"
       href="#src-shell-mdx_ForkExecutor-Details" 
       title="Configuration to fork and execute a command">ForkExecutor Details</a> 
</li>
      </ol>
   </div> 
</li>
      

<li class="nav__item"><a class="nav__link"
       href="#file_src-typescript-mdx" 
       title="Compile and execute typescript code blocks.">Typescript Examples</a>
   <div class="nav__sub">
     <ol class="nav__list">
<li class="nav__item"><a class="md-check__nav-link"
       href="#src-typescript-mdx_Basic" 
       title="undefined">Basic</a> 
</li>
      

<li class="nav__item"><a class="md-check__nav-link"
       href="#src-typescript-mdx_Configuration" 
       title="undefined">Configuration</a> 
</li>
      

<li class="nav__item"><a class="md-check__nav-link"
       href="#src-typescript-mdx_typescript-node-3" 
       title="Code block #2">typescript node #3</a> 
</li>
      </ol>
   </div> 
</li>
      </ol>
</nav>
    <div class="md-check__content">
<section id="file_src-0-README-md" class="md-check__file">
   
<a href="#file_src-0-README-md" 
     class="file__permalink"
     title="Check your docs!"
     rel="instructions">
   <h2 class="file__heading">md-check</h2>
</a>
   <div class="file__content">
     <p><img src="https://github.com/btilford/md-check/workflows/Rush%20CI/badge.svg?branch=master" alt="Rush CI"></p>
<h1 id="md-check">md-check <a class="header-anchor" href="#md-check">¶</a></h1>
<p><em>Compile and execute your markdown documentation.</em></p>
<p><strong>Why?</strong></p>
<ol>
<li>Your docs have drifted out of sync with your codebase.</li>
<li>Your docs are incomplete or wrong and won’t compile.</li>
<li>Your users will thank you.</li>
</ol>
<p><strong>What?</strong></p>
<p>Essentially this is like and borrows a lot from storybook and MDX. But isn’t
focused on UI components.</p>
<ol>
<li>Extract fences from your markdown.</li>
<li>Compile individual blocks if necessary.</li>
<li>Execute each block and optionally capture output.</li>
</ol>
<p>This verifies that</p>
<ol>
<li>Your code at the very least is valid.</li>
<li>Your code is complete including imports because each block compiles and executes by
itself. <em>No more crawling the web for what was actually imported for that random snippet
that was missing pieces.</em></li>
<li>You code executes without an error. You could even execute tests in you code block. Part
of the inspiration for this was Mocha’s <a href="https://mochajs.org/#doc">doc</a> and
<a href="https://mochajs.org/#markdown">markdown</a> reporters.</li>
</ol>
<h2 id="install">Install <a class="header-anchor" href="#install">¶</a></h2>
<pre><code id="src-0-README-md_Installation" class="md-check__code-block language-console"><span class="hljs-meta">#</span><span class="bash"> Run node and other commands</span>
npm install --save-dev @btilford/md-check
<span class="hljs-meta">
#</span><span class="bash"> To compile typescript code blocks</span>
npm install --save-dev @btilford/md-check-compile-typescript
</code></pre>
<h2 id="getting-started">Getting Started <a class="header-anchor" href="#getting-started">¶</a></h2>
<p>The documentation <a href="https://btilford.github.io/md-check//examples.html">here</a> was generated
from the markdown in <a href="examples/src">examples/src</a> by the <a href="examples/md-check.js">md-check.js</a> script .</p>
<p><strong>Configure md-check</strong></p>
<pre><code id="src-0-README-md_Getting-Started" class="md-check__code-block language-javascript"><span class="hljs-keyword">const</span> {mdCheck, NodeVmExecutor} = <span class="hljs-built_in">require</span>(<span class="hljs-string">'@btilford/md-check'</span>);

<span class="hljs-keyword">const</span> run = mdCheck({
    <span class="hljs-attr">include</span>: {
        <span class="hljs-attr">patterns</span>: [
            <span class="hljs-string">'docs/**/*.{md,mdx}'</span>
        ]
    },
    <span class="hljs-attr">executors</span>: [
        [NodeVmExecutor.supply()]
    ]
});
<span class="hljs-comment">// Calling run() will trigger execution.</span>
</code></pre>
<h2 id="development">Development <a class="header-anchor" href="#development">¶</a></h2>
<p>If you don’t have <a href="https://rushjs.io/">rush</a> installed you’ll need to get that.</p>
<pre><code id="src-0-README-md_Development" class="md-check__code-block language-console">npm install -g @microsoft/rush
</code></pre>
<p>Clone and initialize</p>
<pre><code id="src-0-README-md_" class="md-check__code-block language-console">git clone git@github.com:btilford/md-check.git
rush install
</code></pre>
<p>Building</p>
<pre><code id="src-0-README-md_" class="md-check__code-block language-console">rush build
</code></pre>
   </div>
</section>
    
<section id="file_src-1-writing-markdown-md" class="md-check__file">
   
<a href="#file_src-1-writing-markdown-md" 
     class="file__permalink"
     title="How to write the markdown for md-check to work."
     rel="instructions">
   <h2 class="file__heading">Writing Markdown.</h2>
</a>
   <div class="file__content">
     <h3 id="making-code-blocks-executable">Making code blocks executable <a class="header-anchor" href="#making-code-blocks-executable">¶</a></h3>
<p>Executors get passed the fence and can either accept it or skip it.
The node vm executor will split the fence’s name and check if the last
item in the array is <strong>node</strong> or <strong>node-vm</strong>.</p>
<pre><code>```javascript node
console.log('This would be executed by the node vm executor');
```


```javascript node-vm
console.log('This would be executed by the node vm executor');
```


```javascript js
console.warn('This would NOT be executed by the node vm executor');
```
</code></pre>
<h3 id="file-metadata">File metadata <a class="header-anchor" href="#file-metadata">¶</a></h3>
<p>Metadata is YAML parsed out of the header block of the file. The currently support
entries are.</p>
<pre><code id="src-1-writing-markdown-md_Executing-Code-Blocks" class="md-check__code-block language-yaml"><span class="hljs-attr">title:</span> <span class="hljs-string">Title</span> <span class="hljs-string">for</span> <span class="hljs-string">the</span> <span class="hljs-string">file</span> <span class="hljs-comment"># Used to generate header and link text</span>
<span class="hljs-attr">description:</span> <span class="hljs-string">Added</span> <span class="hljs-string">to</span> <span class="hljs-string">link.title</span> 
<span class="hljs-attr">env:</span> <span class="hljs-comment"># Provide env parameters for the file</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">NODE_ENV:</span> <span class="hljs-string">test</span>
<span class="hljs-attr">fences:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">title:</span> <span class="hljs-string">Title</span> <span class="hljs-string">for</span> <span class="hljs-string">code</span> <span class="hljs-string">block</span> <span class="hljs-number">0</span> <span class="hljs-comment"># Used on links to specific code blocks</span>
      <span class="hljs-attr">description:</span> <span class="hljs-string">Added</span> <span class="hljs-string">to</span> <span class="hljs-string">link.title</span>
      <span class="hljs-attr">env:</span> <span class="hljs-comment"># Provide env parameters specific for this block</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">NODE_ENV:</span> <span class="hljs-string">production</span>
</code></pre>
   </div>
</section>
    
<section id="file_src-mocha-mdx" class="md-check__file">
   
<a href="#file_src-mocha-mdx" 
     class="file__permalink"
     title="Execute code blocks containing mocha tests"
     rel="instructions">
   <h2 class="file__heading">Run Mocha</h2>
</a>
   <div class="file__content">
     <h3 id="configure-the-mochaexecutor">Configure the MochaExecutor <a class="header-anchor" href="#configure-the-mochaexecutor">¶</a></h3>
<p><strong>Installation</strong></p>
<pre><code id="src-mocha-mdx_Example-Test" class="md-check__code-block language-console">npm install --save-dev @btilford/md-check
npm install --save-dev @btilford/md-check-exec-mocha
</code></pre>
<p><strong>Configuration</strong></p>
<pre><code id="src-mocha-mdx_Install" class="md-check__code-block language-javascript"><span class="hljs-keyword">const</span> {MochaExecutor} = <span class="hljs-built_in">require</span>(<span class="hljs-string">'@btilford/md-check-exec-mocha'</span>);

MochaExecutor.supply(); <span class="hljs-comment">// use the defaults</span>
MochaExecutor.supply(
    {<span class="hljs-attr">ui</span>: <span class="hljs-string">'bdd'</span>}, <span class="hljs-comment">// Pass in Mocha.MochaOptions object (a custom reporter will be used unless you provide one)</span>
    <span class="hljs-literal">false</span> <span class="hljs-comment">// Don't fail on test failure. (default is true)</span>
);

</code></pre>
<h3 id="running-mocha-tests">Running Mocha Tests <a class="header-anchor" href="#running-mocha-tests">¶</a></h3>
<p><em>Inside your markdown file add a code fence ending with <strong>mocha</strong>,  <strong>```javascript mocha</strong>.</em></p>
<pre><code id="src-mocha-mdx_Configure" class="md-check__code-block language-typescript"><span class="hljs-keyword">import</span> {expect} <span class="hljs-keyword">from</span> <span class="hljs-string">'chai'</span>;

describe(<span class="hljs-string">'My test'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    it(<span class="hljs-string">'Runs this test'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        expect(<span class="hljs-literal">true</span>).to.eq(<span class="hljs-literal">true</span>);
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'In test'</span>);
    });
});
</code></pre>
<div id="exec_src/mocha.mdx_17_out" class="execution__output">
<p><em>stdout &gt;</em><br></p>
   <pre><code class="execution__code-block language-shell"><span class="hljs-meta">&gt;&nbsp;</span><span class="hljs-bash shell"><span class="hljs-string stdout">In test</span></span></code></pre>
</div>
   </div>
</section>
    
<section id="file_src-node-mdx" class="md-check__file">
   
<a href="#file_src-node-mdx" 
     class="file__permalink"
     title="Executing javascript code blocks."
     rel="instructions">
   <h2 class="file__heading">Node Examples</h2>
</a>
   <div class="file__content">
     <h3 id="capture-stdout-and-stderr">Capture stdout and stderr <a class="header-anchor" href="#capture-stdout-and-stderr">¶</a></h3>
<pre><code id="src-node-mdx_Capture-stdout" class="md-check__code-block language-javascript"><span class="hljs-built_in">console</span>.log(<span class="hljs-string">'A log message'</span>);
</code></pre>
<div id="exec_src/node.mdx_3_out" class="execution__output">
<p><em>stdout &gt;</em><br></p>
   <pre><code class="execution__code-block language-shell"><span class="hljs-meta">&gt;&nbsp;</span><span class="hljs-bash shell"><span class="hljs-string stdout">A log message</span></span></code></pre>
</div>
<h3 id="setting-up-the-nodevmexecutor">Setting up the NodeVMExecutor <a class="header-anchor" href="#setting-up-the-nodevmexecutor">¶</a></h3>
<p>This uses <a href="https://github.com/patriksimek/vm2">VM2</a> to execute the scripts in a sandbox.
All the standard vm2 options can be passed in.</p>
<pre><code id="src-node-mdx_Configuration" class="md-check__code-block language-typescript"><span class="hljs-keyword">import</span> {NodeVmExecutor} <span class="hljs-keyword">from</span> <span class="hljs-string">'@btilford/md-check'</span>;

NodeVmExecutor.supply(); <span class="hljs-comment">// Use defaults</span>
NodeVmExecutor.supply({<span class="hljs-comment">/* vm2 options */</span>});
</code></pre>
   </div>
</section>
    
<section id="file_src-shell-mdx" class="md-check__file">
   
<a href="#file_src-shell-mdx" 
     class="file__permalink"
     title="Executing shell script blocks."
     rel="instructions">
   <h2 class="file__heading">Shell Examples</h2>
</a>
   <div class="file__content">
     <h3 id="run-code-block-a-bash-script">Run code block a bash script <a class="header-anchor" href="#run-code-block-a-bash-script">¶</a></h3>
<pre><code id="src-shell-mdx_bash" class="md-check__code-block language-shell">echo "Hello from bash"
echo "Goodbye" 1&gt;&amp;2
</code></pre>
<div id="exec_src/shell.mdx_3_out" class="execution__output">
<p><em>stdout &gt;</em><br></p>
   <pre><code class="execution__code-block language-shell"><span class="hljs-meta">&gt;&nbsp;</span><span class="hljs-bash shell"><span class="hljs-string stdout">Hello from bash</span></span></code></pre>
<p><em>stderr &gt;</em><br></p>
   <pre><code class="execution__code-block language-shell"><span class="hljs-meta">&gt;&nbsp;</span><span class="hljs-bash shell"><span class="hljs-string stderr">Goodbye</span></span></code></pre>
</div>
<p>This requires configuring a <strong>WriteSourceCompiler</strong> and a <strong>ForkExecutor</strong> that will
create a command resembling <code>bash $COMPILED_FILE</code> which will expand to the path
where the code block was written by the WriteSourceCompiler.</p>
<pre><code id="src-shell-mdx_" class="md-check__code-block language-typescript"><span class="hljs-keyword">import</span> {WriteSourceCompiler, ForkExecutor} <span class="hljs-keyword">from</span> <span class="hljs-string">'@btilford/md-check'</span>;

<span class="hljs-comment">// This will generate a temp file with the code block's contents</span>
WriteSourceCompiler.supply(<span class="hljs-regexp">/bash$/</span>)

ForkExecutor.supply(
    <span class="hljs-regexp">/bash$/</span>,
    <span class="hljs-string">'bash'</span>,
    {},
    <span class="hljs-string">'$COMPILED_FILE'</span>, <span class="hljs-comment">// Will insert the path provided by the WriteSourceCompiler</span>
);
</code></pre>
<h3 id="eval-a-code-block">Eval a code block <a class="header-anchor" href="#eval-a-code-block">¶</a></h3>
<pre><code id="src-shell-mdx_eval" class="md-check__code-block language-shell">echo "OS Type: $(uname)"
</code></pre>
<div id="exec_src/shell.mdx_11_out" class="execution__output">
<p><em>stdout &gt;</em><br></p>
   <pre><code class="execution__code-block language-shell"><span class="hljs-meta">&gt;&nbsp;</span><span class="hljs-bash shell"><span class="hljs-string stdout">OS Type: Linux</span></span></code></pre>
</div>
<p>This can be setup with a <strong>ForkExecutor</strong></p>
<pre><code id="src-shell-mdx_" class="md-check__code-block language-typescript"><span class="hljs-keyword">import</span> {ForkExecutor} <span class="hljs-keyword">from</span> <span class="hljs-string">'@btilford/md-check'</span>;

ForkExecutor.supply(
    <span class="hljs-regexp">/eval$/</span>,
    <span class="hljs-string">'eval'</span>,
    {},
    <span class="hljs-string">'"$SOURCE"'</span>, <span class="hljs-comment">// Eval the code block's source.</span>
);
</code></pre>
<h3 id="configuring-a-forkexecutor">Configuring a ForkExecutor <a class="header-anchor" href="#configuring-a-forkexecutor">¶</a></h3>
<p>The fork executor takes the following arguments.</p>
<ol>
<li>A pattern to match on the fence name.</li>
<li>The command to run.</li>
<li><em>(optional)</em> Default env properties. These can be overridden in your markdown
at file or fence level.</li>
<li><em>(optional)</em> A var args to pass to the command.</li>
</ol>
<p>In addition the command will have access to the following env properties</p>
<ul>
<li><strong>COMPILED_FILE</strong> will be set if the file goes through compilation</li>
<li><strong>SOURCE_FILE</strong> the uncompiled file containing the fence’s code <em>(not the original markdown file)</em>.</li>
<li><strong>SOURCE</strong> the raw source of the file.</li>
</ul>
<pre><code id="src-shell-mdx_ForkExecutor-Details" class="md-check__code-block language-typescript"><span class="hljs-keyword">import</span> {ForkExecutor} <span class="hljs-keyword">from</span> <span class="hljs-string">'@btilford/md-check'</span>;

ForkExecutor.supply(
    <span class="hljs-regexp">/bash|sh$/</span>, <span class="hljs-comment">// match fence names ending with bash or sh</span>
    <span class="hljs-string">'bash'</span>,  <span class="hljs-comment">// execute bash</span>
    {}, <span class="hljs-comment">// no env defaults</span>
    <span class="hljs-string">'-e'</span>, <span class="hljs-string">'$SOURCE'</span> <span class="hljs-comment">// args eval source</span>
);
ForkExecutor.supply(
    <span class="hljs-regexp">/babel$/</span>,
    <span class="hljs-string">'babel'</span>,
    {NODE_ENV: process.env.NODE_ENV},
    <span class="hljs-string">'$SOURCE_FILE'</span>, <span class="hljs-string">'--out-dir'</span>, <span class="hljs-string">'dist/'</span>
);
ForkExecutor.supply(
    <span class="hljs-regexp">/npm$/</span>,
    <span class="hljs-string">'npm'</span>,
    {},
    <span class="hljs-string">'run'</span>, <span class="hljs-string">'build'</span>
);
</code></pre>
   </div>
</section>
    
<section id="file_src-typescript-mdx" class="md-check__file">
   
<a href="#file_src-typescript-mdx" 
     class="file__permalink"
     title="Compile and execute typescript code blocks."
     rel="instructions">
   <h2 class="file__heading">Typescript Examples</h2>
</a>
   <div class="file__content">
     <h3 id="installation">Installation <a class="header-anchor" href="#installation">¶</a></h3>
<pre><code id="src-typescript-mdx_Basic" class="md-check__code-block language-console">npm install --save-dev @btilford/md-check-compile-typescript
</code></pre>
<h3 id="setup-the-typescript-compiler">Setup the Typescript compiler <a class="header-anchor" href="#setup-the-typescript-compiler">¶</a></h3>
<pre><code id="src-typescript-mdx_Configuration" class="md-check__code-block language-typescript"><span class="hljs-keyword">import</span> {TsCompiler} <span class="hljs-keyword">from</span> <span class="hljs-string">'@btilford/md-check-compile-typescript'</span>;

TsCompiler.supply(); <span class="hljs-comment">// default configs, uses ${process.cwd()}/tsconfig.json</span>
TsCompiler.supply(<span class="hljs-string">'tsconfig.json'</span>); <span class="hljs-comment">// Provide a path to you tsconfig</span>
TsCompiler.supply({<span class="hljs-comment">/* compiler options */</span>}); <span class="hljs-comment">// Provide a configuration object</span>
</code></pre>
<h3 id="compile-and-run">Compile and run <a class="header-anchor" href="#compile-and-run">¶</a></h3>
<p><em>Inside your markdown file add a code fence starting with <strong>typescript</strong> <strong>```typescript</strong>.</em></p>
<pre><code id="src-typescript-mdx_typescript-node-3" class="md-check__code-block language-typescript"><span class="hljs-keyword">import</span> {ConsoleLog} <span class="hljs-keyword">from</span> <span class="hljs-string">'@btilford/ts-base'</span>;

<span class="hljs-keyword">const</span> log: Log = ConsoleLog.create(<span class="hljs-string">'example'</span>);
log.info(<span class="hljs-string">'Hello'</span>);
</code></pre>
   </div>
</section>
    </div>
<section class="md-check__footer">
   <span class="footer__project-name">@btilford/md-check</span>
   <span class="footer__project-version">v1.0.1</span>
   <span class="footer__timestamp">2020-04-13T05:32:16.425Z</span>
</section>
</main>
  